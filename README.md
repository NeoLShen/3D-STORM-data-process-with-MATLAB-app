# MATLAB codes manual
These are codes for 3D STORM data analysis that are coded with MATLAB.

The MATLAB-codes folder contains two files. The imported data should contain the information of x and y coordinates as "Xm" and "Ym", and information of frame number as "Frame". All three variables should be a vector.


"VoronoiTesselation.m" was used to generate 3D tessellation of 2-channel STORM localizations based on the Voronoi diagram. The users should change the file name sequence number before running this script. The output file will be loaded in the next step analysis.


"STORMprocess.mlapp" was a MATLAB app with a GUI that combined multiple functions.

When users use this app to manually select the ROI of a synaptic region, they should load the essential files with the "Load Image" button. This button needs users to manually select a PNG file of a certain wide field image, and will automatically load corresponding supper resolution coordinates and Voronoi diagram-based tessellation information that was generated before. The center message box will print "OK!" when it is done. If the number of displayed coordinates is too large, the users can manually control the upper limit of coordinates displayed on the upper left text box. The wide field image and the supper resolution coordinates with a synchronized axis will be displayed on the left two panels. Users can zoom in on either panel to find a potential synaptic region and use the "Select Synapse" button to manually label the synaptic region with a cross on either panel. The total number of selected ROIs and the current ROI number will be displayed in the center text boxes. The following step is to select the ROI of localizations in the current labeled synaptic region with the "Select Cluster" button. After selecting the ROI, the bottom right panel will display a 3D view of the localizations in this ROI, and the users can rotate the angle of view interactively. The users can further exclude "non-clustered" either manually with the "Select in this view" button in the upper right panel or automatically with the "Auto Select" button. The "Auto Select" button determines whether a certain localization is a clustered  localization by comparing the mean value of first-order neighbors' volume with the average value volume of all localizations. The button center slider can tune the threshold of the ratio of average local density for each channel. The check box "Infinite" will bypass the threshold and retain all localizations in a certain channel. The coordinates that will be excluded in certain thresholds will be displayed in different colors in the bottom right panel. If the users are satisfied with the auto-selection results, they can directly use the "Use auto Results" button to save the current results. If the users are not satisfied with any stage of selection, they can use the "Delete current" button to delete the current selection of the synaptic region or cluster in the dataset. The users can save the selected dataset to the computer by clicking the "Finish Select" button at any time. The users can load previously saved selected datasets by clicking the "Load last" button.

When users use this app to analyze the PSD plane distribution, they should load the selected dataset with the "Check Selected" button. The users can change the value of the "No. of Synapse" text box and click the "Fit axial" button to fit the two-channel localizations with different PCA axial. A 3D view of the localizations will be displayed in the bottom right panel with a certain PCA axial view angle (the PCA axial order 1,2,3 can be changed in the "angle" text box) and the distribution curve alone this axial. The "Smooth span" was used to change the smooth span window of the curve. If there are multiple major peaks in the distribution curve, the users can change the calculated peak number with the "Peak count" text box. The users can output the distribution curve in the upper right panel by clicking the "Export" button. When the users finish fitting with the current cluster, use the "Save Dis" button to save the fitting results. After finishing all fitting of certain datasets, the users can output the fitting results by clicking the "Output distance" button.

When users use this app to render 3D STORM images of certain clusters, they can use the "Draw in this vie" button to check the 2D projection of certain clusters that a cluster with the projection angle of what is displayed in the bottom right panel. If the user satisfied with current results, they can export 2D projection of rendered STORM images with the "Render" button.


If you encounter any technical problems, please contact the author by email: "zshenai@connect.ust.hk" or "shenzeyu@ust.hk"
